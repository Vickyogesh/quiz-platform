<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Quiz Platform</title>

<link rel="stylesheet" type="text/css" href="css/style.css" />
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/cookie.js"></script>
<script type="text/javascript" src="js/app.js"></script>
<script src="js/graph/raphael-min.js" type="text/javascript" charset="utf-8"></script>
<script src="js/graph/g.raphael.js" type="text/javascript"></script>
<script src="js/graph/g.line.js" type="text/javascript" charset="utf-8"></script>
<script src="js/graph/g.pie.js" type="text/javascript" charset="utf-8"></script>

<!--Please wait-->
<link rel="stylesheet" type="text/css" href="js/please_wait/pleasewait.css">
<script type="text/javascript" src="js/please_wait/pleasewait.js"></script>
<!--Please wait-->

<script>
	var i, sHtml;
	var examData;	
	var bFromExam;
	
	$(document).ready(function() {		
		
		window.qsid = getCookie("qsid");
		window.name = getCookie("name");
		
		bFromExam = getCookie("fromexam");				
		
		$("#statarea").hide();
		WaitMsg.show();
						
		$.getJSON(url("/v1/student/me/exam"), 
			function(data) {
				if (data.status != 200) {
					WaitMsg.hide();
					aux_showJSONError(data);
				}
				else {
					
					examData = data;
					data = {};
					data.lang = "it";
					
					$.getJSON(url("/v1/student/me"), data, function(data) {
						if (data.status != 200) {
							WaitMsg.hide();
							aux_showJSONError(data);
						}
						else {
							WaitMsg.hide();					
							
							$("#statarea").show();
							$("#name").html(data.student.name + ' ' + data.student.surname);					
					
							var examX = [];
							var examY = [];
							var examY1 = [];
							var examY2 = [0, 40];
							var nCount = 0;
							
							for (i = 0; i < examData.exams.length; i++) {
								if (examData.exams[i].status == "passed" || examData.exams[i].status == "failed") {							
									examX.push(nCount);
									examY.push(40 - examData.exams[i].errors);
									examY1.push(36);
									nCount++;
								}
							}
						
							var r = Raphael("examgraph");
							var echart = r.linechart(7, 0, $('#examgraph').width()-10, $('#examgraph').height()-10, 
													examX, 
													[examY2, examY, examY1], 
													{axis:"0 0 1 1", axisxstep:examX.length - 1, colors:['#fff', '#0000ff', '#13ff7e']});
												
							var xText = echart.axis[0].text.items;  
							for(i in xText){ // Iterate through the array of dom elems, the current dom elem will be i
								var nVal = parseInt(xText[i].attr('text')) + 1;
								xText[i].attr({'text': nVal + ''}); // Set the text of the current elem with the result
							}
						
							// filling topic statistics
							for (i = 0; i < data.topics.length; i++) {
								sHtml = '<li><a id="' + (i+1) + '" href="#">';
								sHtml += '<div id="tgraph' + (i+1) + '" style="width:20px; height:20px; float:right; margin-top:-2px"></div>';
								sHtml += data.topics[i].text;
								sHtml += '</a></li>';
								$("#topic ul").append(sHtml);
								
								var id = 'tgraph' + (i+1);
								var r = Raphael(id);
								var nError = data.topics[i].errors.current;
								if (nError != null && nError > 0)
									r.piechart(10, 10, 10, [100 - nError, nError], {strokewidth:0, colors:['#c20808','#219429']});
							}
							
							//
							// topic click events
							//
							$('#topic ul li a').click(function(){
								// showing topic errors
								$('#menu').hide();
								$('#statarea').css('width', '520px');
								
								var sHtml;
								
								$("#topicerrorlist").empty();
								
								sHtml = '<li>';
								sHtml += '<a id="back" style="cursor:pointer">';
								sHtml += '&nbsp;&nbsp;&nbsp;&nbsp;<-&nbsp;Back</a>';
								sHtml += '</li>';
								$("#topicerrorlist").append(sHtml);

								sHtml = '<li>';
								sHtml += '<a id="' + $(this).attr('id') + '" style="cursor:pointer">';
								sHtml += 'Question List Topic ' + $(this).attr('id') + '</a>';
								sHtml += '<ul>'
								sHtml += '</ul>';
								sHtml += '</li>';
								
								$("#topicerrorlist").append(sHtml);
								
								// filling lists
								WaitMsg.show();
					
								data = {};
								data.lang = "it";
								
								$.getJSON(url("/v1/student/me/topicerrors/" + $(this).attr('id')), data, function(data) {
									if (data.status != 200) {
										WaitMsg.hide();
										aux_showJSONError(data);
									}
									else {
										WaitMsg.hide();
										
										$('#topicerrorlist').show();
										
										var id;
										for (i = 0; i < data.questions.length; i++) {
											id = data.questions[i].id + '_' + i;
											
											sHtml = '<li><a id="' + id + '">';
								
											var image = "https://quizplatform-editricetoni.rhcloud.com/img/" + data.questions[i].image + ".jpg";
											sHtml += '<div class="img" style="width:30px; height:30px; float:left; margin-right:5px; background-image:';
											sHtml += "url('" + image + "');" + 'background-size:contain; background-position:center; background-repeat: no-repeat;">';
											sHtml += '</div>';
											
											var result;
											sHtml += '<div class="result" style="width:30px; height:30px; float:right; margin-left:5px; font-size:20px; text-align:center">';
											if (data.questions[i].answer == 1)
												result = 'V';
											else
												result = 'F';
												
											sHtml += result;
											sHtml += '</div>';
											
											sHtml += 'Question ' + data.questions[i].id + '<br>';
											sHtml += data.questions[i].text;
											sHtml += '</a></li>';
											
											$("#topicerrorlist ul").append(sHtml);
										}
										
										// resizing images of the items
										var nHeight;
										for (i = 0; i < data.questions.length; i++) {
											id = data.questions[i].id + '_' + i;
											nHeight = $('#' + id).height() + 5;
											$('#' + id + ' .img').css('height', nHeight + 'px');
											$('#' + id + ' .result').css('height', nHeight + 'px');
											$('#' + id + ' .result').css('line-height', nHeight + 'px');
										}
									}
								})
								.error(function(data) {
									aux_showError(data.responseText, data.status);
								});
								
								$('#topicerrorlist #back').click(function(){
									$('#topicerrorlist').hide();
									$('#statarea').css('width', '520px');
									$('#menu').show();
								});
							});
							
							if (bFromExam == 1)
								showExamList();
						}
					})
					.error(function(data) {
						WaitMsg.hide();
						aux_showError(data.responseText, data.status);
					});				
				}
			})
			.error(function(data) {
				WaitMsg.hide();
				aux_showError(data.responseText, data.status);
			});
			
		$("#examgraph").click(function(){			
			showExamList();		
		});
		
		$('#backbut').click(function(){
			window.location = "menu.html";
		});
		
		$('#btnlogout').click(function(){
			window.qsid = null;
			window.location = "index.html";
		});
	});
	
	function showExamList() {
		$('#menu').hide();
		$('#statarea').css('width', '520px');
		
		if ($.trim($("#examlist").html()) == '') {
			sHtml = '<li class="examid">';
			sHtml += '<a id="back" style="cursor:pointer">';
			sHtml += '&nbsp;&nbsp;&nbsp;&nbsp;<-&nbsp;Back</a>';
			sHtml += '</li>';
			$("#examlist").append(sHtml);
			
			var correctNum;
			for (i = 0; i < examData.exams.length; i++) {
				if (examData.exams[i].status == "passed" || examData.exams[i].status == "failed") {					
					
					correctNum = 40 - examData.exams[i].errors;
					
					sHtml = '<li class="examid">';
					sHtml += '<a id="' + examData.exams[i].id + '" style="cursor:pointer">';
					sHtml += 'Exam ' + examData.exams[i].id + '&nbsp;(' + correctNum + '/40)' + '&nbsp;&nbsp;&nbsp;&nbsp;' + examData.exams[i].end + '</a>';
					sHtml += '<ul>';
					sHtml += '</ul>';
					sHtml += '</li>'
					
					$("#examlist").append(sHtml);
				}
			}
		}
		
		$('#examlist').show();
		
		$('#examlist .examid a').click(function(){
			var checkElement = $(this).next();
			
			if ($(this).attr('id') == 'back') {
				$('#examlist').hide();
				$('#statarea').css('width', '520px');
				$('#menu').show();
				return;
			}
			
			if (checkElement.children().length == 0) {
				
				WaitMsg.show();
				
				data = {};
				data.lang = "it";
				
				$.getJSON(url("/v1/exam/" + $(this).attr('id')), function(data) {
					if (data.status != 200) {
						WaitMsg.hide();
						aux_showJSONError(data);
					}
					else {
						WaitMsg.hide();
						
						var id;
						for (i = 0; i < data.questions.length; i++) {
							id = data.questions[i].id + '_' + i;
							
							sHtml = '<li><a id="' + id + '">';
							
							var image = "https://quizplatform-editricetoni.rhcloud.com/img/" + data.questions[i].image + ".jpg";
							sHtml += '<div class="img" style="width:30px; height:30px; float:left; margin-right:5px; background-image:';
							sHtml += "url('" + image + "');" + 'background-size:contain; background-position:center; background-repeat: no-repeat;">';
							sHtml += '</div>';
							
							var result, bkcolor;
							if (data.questions[i].is_correct == 1)
								bkcolor = '#468847';
							else
								bkcolor = '#b94a48';

							sHtml += '<div class="quizresult">';
							sHtml += '<div style="text-align:center; background-color:' + bkcolor +';">';
							
							if (data.questions[i].answer == 1)
								result = 'V';
							else
								result = 'F';

							sHtml += result;
							sHtml += '</div></div>';
							
							sHtml += 'Question ' + data.questions[i].id + '<br>';
							sHtml += data.questions[i].text;
							sHtml += '</a></li>';
							
							checkElement.append(sHtml);
						}
						
						// resizing images of the items
						var nHeight;
						for (i = 0; i < data.questions.length; i++) {
							id = data.questions[i].id + '_' + i;
							nHeight = $('#' + id).height() + 5;
							$('#' + id + ' .img').css('height', nHeight + 'px');
							$('#' + id + ' .quizresult').css('height', nHeight + 'px');
						}
					}
				});					
			}
			else {
				if(checkElement.is(':visible')) {
    				checkElement.slideUp('normal');
    			}
				if(!checkElement.is(':visible')) {
					checkElement.slideDown('normal');
				}
			}				
		});
	}
	
</script>
	
</head>

<body>
	<div id="work_area">
		<div id="statarea">
			
        	<div id="logoutarea" style="text-align:right;">
				<a id="btnlogout" href="#" >Log out</a>				
			</div>
			
			<h1 id="name">Name Surname</h1>

			<div style="width:321px; margin:auto">
	        	<ul class="nav" style="padding:0px">
	                <li class="nav-one"><a href="#featured" class="current">Last week</a></li>
	                <li class="nav-two"><a href="#core">Last month</a></li>
	                <li class="nav-three"><a href="#jquerytuts">All</a></li>
	            </ul>
            </div>
        	
        	<div class="list-wrap" style="padding-left:5px; padding-right:5px">
        		<ul id="menu" class="parentitem">
        			<li id="exam" style="height:150px">
						<span style="padding:7px; display:block; color:#fff">Exam Statistics</span>
						<div id="examgraph" style="width:250px; height:110px; float:right; background-color:#fff; margin-right:120px; cursor:pointer">
						</div>
					</li>
					<li id="topic">
						<span style="padding:7px; display:block; color:#fff">Topic Statistics</span>
						<ul>
						</ul>
					</li>
				</ul>
<!--        	
        		<ul id="featured">
        			<li><a href="http://css-tricks.com/perfect-full-page-background-image/">Full Page Background Images</a></li>
        			<li><a href="http://css-tricks.com/designing-for-wordpress-complete-series-downloads/">Designing for WordPress</a></li>
        			<li><a href="http://css-tricks.com/build-your-own-social-home/">Build Your Own Social Home!</a></li>
        			<li><a href="http://css-tricks.com/absolute-positioning-inside-relative-positioning/">Absolute Positioning Inside Relative Positioning</a></li>
        			<li><a href="http://css-tricks.com/ie-css-bugs-thatll-get-you-every-time/">IE CSS Bugs That'll Get You Every Time</a></li>
        			<li><a href="http://css-tricks.com/404-best-practices/">404 Best Practices</a></li>
        			<li><a href="http://css-tricks.com/date-display-with-sprites/">Date Display with Sprites</a></li>
        		</ul>
        		 
        		 <ul id="core" class="hide">
                    <li><a href="http://css-tricks.com/video-screencasts/58-html-css-the-very-basics/">The VERY Basics of HTML &amp; CSS</a></li>
                    <li><a href="http://css-tricks.com/the-difference-between-id-and-class/">Classes and IDs</a></li>
                    <li><a href="http://css-tricks.com/the-css-box-model/">The CSS Box Model</a></li>
                    <li><a href="http://css-tricks.com/all-about-floats/">All About Floats</a></li>
                    <li><a href="http://css-tricks.com/the-css-overflow-property/">CSS Overflow Property</a></li>
        			<li><a href="http://css-tricks.com/css-font-size/">CSS Font Size - (px - em - % - pt - keyword)</a></li>
        			<li><a href="http://css-tricks.com/css-transparency-settings-for-all-broswers/">CSS Transparency / Opacity</a></li>
        			<li><a href="http://css-tricks.com/css-sprites/">CSS Sprites</a></li>
        			<li><a href="http://css-tricks.com/nine-techniques-for-css-image-replacement/">CSS Image Replacement</a></li>
        		 	<li><a href="http://css-tricks.com/what-is-vertical-align/">CSS Vertial Align</a></li>
        			<li><a href="http://css-tricks.com/the-css-overflow-property/">The CSS Overflow Property</a></li>
        		 </ul>
        		 
        		 <ul id="jquerytuts" class="hide">
        		    <li><a href="http://css-tricks.com/anythingslider-jquery-plugin/">Anything Slider jQuery Plugin</a></li>
        		    <li><a href="http://css-tricks.com/moving-boxes/">Moving Boxes</a></li>
        			<li><a href="http://css-tricks.com/simple-jquery-dropdowns/">Simple jQuery Dropdowns</a></li>
        			<li><a href="http://css-tricks.com/creating-a-slick-auto-playing-featured-content-slider/">Featured Content Slider</a></li>
        			<li><a href="http://css-tricks.com/startstop-slider/">Start/Stop Slider</a></li>
        			<li><a href="http://css-tricks.com/banner-code-displayer-thing/">Banner Code Displayer Thing</a></li>
        			<li><a href="http://css-tricks.com/highlight-certain-number-of-characters/">Highlight Certain Number of Characters</a></li>
        			<li><a href="http://css-tricks.com/auto-moving-parallax-background/">Auto-Moving Parallax Background</a></li>
        		 </ul>
-->        		         	
				<!-- exam list -->
				<ul id="examlist" style="show:hidden" class="parentitem">
				</ul>
				
				<!-- topic error list -->
				<ul id="topicerrorlist" style="show:hidden" class="parentitem">
				</ul>
        	</div> <!-- END List Wrap -->
        	
        	<div style="width:100%; height:70px">
				<a class="button" id="backbut" style="margin:15px; padding:10px; font-size:22px; float:left; margin-left:150px">
					Back to main menu
				</a>
			</div>
         
         </div> <!-- END Organic Tabs (Example One) -->
	</div>
</body>

</html>